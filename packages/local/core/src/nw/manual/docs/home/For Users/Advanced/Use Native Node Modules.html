<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <html>Use Native Node Modules</html>
  <meta name="generator" content="Haroopad 0.13.2" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../../../asset/clearness-dark.css">
</head>
<body class="markdown clearness-dark">
<h1 id="use-native-node-modules"><a name="use-native-node-modules" href="#use-native-node-modules"></a>Use Native Node Modules</h1><hr class="section"><div class="toc"><ul>
<li><ul>
<li><span class="html">
<a href="#install-with-npm" html="Install with NPM">Install with NPM</a>
</span>
<!--span class="number">
0
</span-->
<ul>
<li><span class="html">
<a href="#for-lts-releases" html="For LTS Releases">For LTS Releases</a>
</span>
<!--span class="number">
1
</span-->
</li>
<li><span class="html">
<a href="#for-non-lts-releases" html="For non-LTS Releases">For non-LTS Releases</a>
</span>
<!--span class="number">
2
</span-->
</li>
</ul>
</li>
<li><span class="html">
<a href="#manually-rebuild" html="Manually Rebuild">Manually Rebuild</a>
</span>
<!--span class="number">
3
</span-->
<ul>
<li><span class="html">
<a href="#nw-gyp" html="nw-gyp">nw-gyp</a>
</span>
<!--span class="number">
4
</span-->
</li>
<li><span class="html">
<a href="#node-pre-gyp" html="node-pre-gyp">node-pre-gyp</a>
</span>
<!--span class="number">
5
</span-->
</li>
</ul>
</li>
</ul>
</li>

</ul>
</div><h2 id="install-with-npm"><a name="install-with-npm" href="#install-with-npm"></a>Install with NPM</h2><h3 id="for-lts-releases"><a name="for-lts-releases" href="#for-lts-releases"></a>For LTS Releases</h3><p>!!! warning “Use Same Version and Architecture of Node.js and NW.js”<br>    Following instructions only works if you are using the same version and architecture of Node.js and NW.js.</p><p>If you are using LTS release, native modules installed by <code>npm</code> can be supported after hacking as below:</p><ul>
<li>On Linux and Mac, no hacking is required.</li><li>On Windows, you need to replace the file<br><code>&lt;npm-path&gt;\node_modules\node-gyp\src\win_delay_load_hook.cc</code> with the one at <a href="https://github.com/nwjs/nw.js/blob/nw18/tools/win_delay_load_hook.cc">https://github.com/nwjs/nw.js/blob/nw18/tools/win_delay_load_hook.cc</a> before installing modules with node-gyp or npm.</li></ul><h3 id="for-non-lts-releases"><a name="for-non-lts-releases" href="#for-non-lts-releases"></a>For non-LTS Releases</h3><p>If you are using non-LTS release, <code>nw-gyp</code> is required to be pre-installed globally to build modules due to <a href="https://github.com/nwjs/nw.js/issues/5025">ABI differences in V8</a>. These instructions below works for LTS releases as well.</p><p>To install native modules for NW.js, run following commands in your terminal:</p><pre class="bash hljs"><span class="hljs-comment"># Install nw-gyp globally</span>
npm install -g nw-gyp
<span class="hljs-comment"># Setup target NW.js version</span>
<span class="hljs-built_in">export</span> npm_config_target=<span class="hljs-number">0.18</span>.<span class="hljs-number">5</span>
<span class="hljs-comment"># Setup build architecture, ia32 or x64</span>
<span class="hljs-built_in">export</span> npm_config_arch=x64
<span class="hljs-built_in">export</span> npm_config_target_arch=x64
<span class="hljs-comment"># Setup env for modules built with node-pre-gyp</span>
<span class="hljs-built_in">export</span> npm_config_runtime=node-webkit
<span class="hljs-built_in">export</span> npm_config_build_from_<span class="hljs-built_in">source</span>=<span class="hljs-literal">true</span>
<span class="hljs-comment"># Setup nw-gyp as node-gyp</span>
<span class="hljs-built_in">export</span> npm_config_node_gyp=$(<span class="hljs-built_in">which</span> nw-gyp)
<span class="hljs-comment"># Run npm install</span>
npm install
</pre><p>!!! warning “Note for Windows”<br>    You will need to have a compiler installed. You can get one by installing the <a href="http://landinghub.visualstudio.com/visual-cpp-build-tools">Visual C++ Build Tools</a>. You will also need Python 2.7 (version 3.x is not supported).<br>    The <code>npm_config_node_gyp</code> environment variable has to be set to <code>path\to\global\node_modules\nw-gyp\bin\nw-gyp.js</code> instead of the <code>nw-gyp.cmd</code> batch script. This is a <a href="https://github.com/npm/npm/issues/14543">bug of npm</a>.<br>    You must use <code>set</code> instead of <code>export</code> to set environment variables in Windows. Here is a full example (Windows 10, Visual C++ Build Tool v2015): </p><pre><code class="batchfile">set PYTHON=C:\Python27\python.exe
set npm_config_target=0.21.6
set npm_config_arch=x64
set npm_config_runtime=node-webkit
set npm_config_build_from_source=true
set npm_config_node_gyp=C:\Users\xxxxxxxxx\AppData\Roaming\npm\node_modules\nw-gyp\bin\nw-gyp.js
npm install --msvs_version=2015
</code></pre><h2 id="manually-rebuild"><a name="manually-rebuild" href="#manually-rebuild"></a>Manually Rebuild</h2><p>!!! tip “Full NPM Install is Recommended”<br>    After a version switch of NW.js, the recommended approach is to delete <code>node_modules</code> folder and do a full npm install as <a href="#install-with-npm">the instructions above</a>.</p><p>Once you switch to a new version of NW.js, you can rebuild <strong>each</strong> of the native modules with the tools below <strong>without reinstall all the modules</strong>. Since <code>binding.gyp</code> is required for building native modules, you can easily locate all native modules by finding <code>binding.gyp</code> file.</p><p>!!! warning “Rebuild ALL Native Modules”<br>    Make sure you <strong>rebuilt all native modules</strong>. Or you will meet various issues, even crashes. Once manually rebuild don’t work for you, try to do a full npm install.</p><h3 id="nw-gyp"><a name="nw-gyp" href="#nw-gyp"></a>nw-gyp</h3><p><a href="https://github.com/nwjs/nw-gyp"><code>nw-gyp</code></a> is a hack on <code>node-gyp</code> to support NW.js specific headers and libraries.</p><p>The usage is the same with <code>node-gyp</code>, except that you need to specify the version and arch (<code>x64</code> or <code>ia32</code>) of NW.js manually.</p><pre class="bash hljs">npm install -g nw-gyp
<span class="hljs-built_in">cd</span> myaddon
nw-gyp rebuild --target=<span class="hljs-number">0.13</span>.<span class="hljs-number">0</span> --arch=x64
</pre><p>See <a href="https://github.com/nwjs/nw-gyp">https://github.com/nwjs/nw-gyp</a> for more details.</p><h3 id="node-pre-gyp"><a name="node-pre-gyp" href="#node-pre-gyp"></a>node-pre-gyp</h3><p>Some packages uses <a href="https://github.com/mapbox/node-pre-gyp">node-pre-gyp</a>, which supports building for both Node.js and NW.js by using either <code>node-gyp</code> or <code>nw-gyp</code>.</p><p>The usage of <code>node-pre-gyp</code> is as following:</p><pre class="bash hljs">npm install -g node-pre-gyp
<span class="hljs-built_in">cd</span> myaddon
node-pre-gyp build --runtime=node-webkit --target=<span class="hljs-number">0.13</span>.<span class="hljs-number">0</span> --target_arch=x64
</pre><p>See <a href="https://github.com/mapbox/node-pre-gyp">https://github.com/mapbox/node-pre-gyp</a> for more details.</p>


</body>
</html>
