<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <html>Building NW.js</html>
  <meta name="generator" content="Haroopad 0.13.2" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../../../asset/clearness-dark.css"></head>
</head>
<body class="markdown clearness-dark">
<h1 id="building-nw.js"><a name="building-nw.js" href="#building-nw.js"></a>Building NW.js</h1><hr class="section"><div class="toc"><ul>
<li><ul>
<li><span class="html">
<a href="#prerequisites" html="Prerequisites">Prerequisites</a>
</span>
<!--span class="number">
0
</span-->
</li>
<li><span class="html">
<a href="#get-the-code" html="Get the Code">Get the Code</a>
</span>
<!--span class="number">
1
</span-->
</li>
<li><span class="html">
<a href="#generate-ninja-build-files-with-gn-for-chromium" html="Generate ninja build files with GN for Chromium">Generate ninja build files with GN for Chromium</a>
</span>
<!--span class="number">
2
</span-->
</li>
<li><span class="html">
<a href="#generate-ninja-build-files-with-gyp-for-node" html="Generate ninja build files with GYP for Node">Generate ninja build files with GYP for Node</a>
</span>
<!--span class="number">
3
</span-->
<ul>
<li><span class="html">
<a href="#32-bit/64-bit-build" html="32-bit/64-bit Build">32-bit/64-bit Build</a>
</span>
<!--span class="number">
4
</span-->
</li>
</ul>
</li>
<li><span class="html">
<a href="#build-nwjs" html="Build nwjs">Build nwjs</a>
</span>
<!--span class="number">
5
</span-->
</li>
<li><span class="html">
<a href="#build-node" html="Build Node">Build Node</a>
</span>
<!--span class="number">
6
</span-->
</li>
<li><span class="html">
<a href="#build-flavors" html="Build Flavors">Build Flavors</a>
</span>
<!--span class="number">
7
</span-->
</li>
<li><span class="html">
<a href="#enable-proprietary-codecs" html="Enable Proprietary Codecs">Enable Proprietary Codecs</a>
</span>
<!--span class="number">
8
</span-->
</li>
<li><span class="html">
<a href="#build-faster" html="Build Faster">Build Faster</a>
</span>
<!--span class="number">
9
</span-->
</li>
</ul>
</li>

</ul>
</div><p>!!! important<br>    Starting from 0.17, we switched to the new build configuration system GN and Ninja in Chromium upstream. The Node.js in NW is still build with GYP/Ninja<br>    This document is written for latest <strong>NW 0.13</strong> or later. For legacy build instructions, please read the <a href="https://github.com/nwjs/nw.js/wiki/Building-nw.js">wiki page</a> on GitHub.<br>    See our buildbot for official build configuration and steps: <a href="http://buildbot-master.nwjs.io:8010/waterfall">http://buildbot-master.nwjs.io:8010/waterfall</a><br>    Debug version should be built with component build configuration. See the <a href="https://groups.google.com/a/chromium.org/d/msg/chromium-dev/LWRR3fMlvQ4/qos4EaBtBgAJ">discussion in upstream</a>.</p><h2 id="prerequisites"><a name="prerequisites" href="#prerequisites"></a>Prerequisites</h2><p>NW.js use same build tools and similar steps as Chromium. Read the instructions according to your platform to install <code>depot_tools</code> and other prerequistes:</p><ul>
<li><a href="https://chromium.googlesource.com/chromium/src/+/master/docs/windows_build_instructions.html">Windows</a></li><li><a href="https://chromium.googlesource.com/chromium/src/+/master/docs/mac_build_instructions.html">Mac OS X</a></li><li><a href="https://chromium.googlesource.com/chromium/src/+/master/docs/linux_build_instructions.html">Linux</a></li></ul><p>!!! note “Windows”<br>    As suggested by Chromium document, you need to run <code>set DEPOT_TOOLS_WIN_TOOLCHAIN=0</code> or set the variable in your global environment.</p><p>!!! note “Xcode 7”<br>    Mac SDK 10.11 as part of Xcode 7 is not supported yet. If you have upgraded to Xcode 7, either downgrade to Xcode 6 or copy Mac SDK 10.10 from other machines under <code>`xcode-select -p`/Platforms/MacOSX.platform/Developer/SDKs</code> as suggested by <a href="https://chromium.googlesource.com/chromium/src/+/master/docs/mac_build_instructions.html">Chromium document</a>.</p><h2 id="get-the-code"><a name="get-the-code" href="#get-the-code"></a>Get the Code</h2><p><strong>Step 1.</strong> Create a folder for holding NW.js source code, like <code>$HOME/nwjs</code>, and run following command in the folder to generate <code>.gclient</code> file:</p><pre class="bash hljs">mkdir -p <span class="hljs-variable">$HOME</span>/nwjs
<span class="hljs-built_in">cd</span> <span class="hljs-variable">$HOME</span>/nwjs
gclient config --name=src https://github.com/nwjs/chromium.src.git@origin/nw17
</pre><p>Generally if you are not interested in running Chromium tests, you don’t have to sync the test cases and reference builds, which saves you lot of time. Open the <code>.gclient</code> file you just created and replace <code>custom_deps</code> section with followings:</p><pre class="python hljs"><span class="hljs-string">"custom_deps"</span> : {
    <span class="hljs-string">"src/third_party/WebKit/LayoutTests"</span>: <span class="hljs-keyword">None</span>,
    <span class="hljs-string">"src/chrome_frame/tools/test/reference_build/chrome"</span>: <span class="hljs-keyword">None</span>,
    <span class="hljs-string">"src/chrome_frame/tools/test/reference_build/chrome_win"</span>: <span class="hljs-keyword">None</span>,
    <span class="hljs-string">"src/chrome/tools/test/reference_build/chrome"</span>: <span class="hljs-keyword">None</span>,
    <span class="hljs-string">"src/chrome/tools/test/reference_build/chrome_linux"</span>: <span class="hljs-keyword">None</span>,
    <span class="hljs-string">"src/chrome/tools/test/reference_build/chrome_mac"</span>: <span class="hljs-keyword">None</span>,
    <span class="hljs-string">"src/chrome/tools/test/reference_build/chrome_win"</span>: <span class="hljs-keyword">None</span>,
}
</pre><p>Manually clone and checkout correct branches for following repositories:</p><table>
<thead>
<tr>
<th style="text-align:left">path</th>
<th style="text-align:left">repo</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">src/content/nw</td>
<td style="text-align:left"><a href="https://github.com/nwjs/nw.js">https://github.com/nwjs/nw.js</a></td>
</tr>
<tr>
<td style="text-align:left">src/third_party/node-nw</td>
<td style="text-align:left"><a href="https://github.com/nwjs/node">https://github.com/nwjs/node</a></td>
</tr>
<tr>
<td style="text-align:left">src/v8</td>
<td style="text-align:left"><a href="https://github.com/nwjs/v8">https://github.com/nwjs/v8</a></td>
</tr>
</tbody>
</table><p><strong>Step 2.</strong> Run following command in your terminal:</p><pre><code>gclient sync --with_branch_heads
</code></pre><p>This usually downloads 20G+ from GitHub and Google’s Git repos. Make sure you have a good network provider and be patient :stuck_out_tongue:</p><p>When finished, you will see a <code>src</code> folder created in the same folder as <code>.gclient</code>.</p><p>!!! note “First Build on Linux”<br>    If you are building on Linux <strong>for the first time</strong>, you need to run <code>gclient sync --with_branch_heads --nohooks</code> and then run <code>./build/install-build-deps.sh</code> to install dependencies on Ubuntu. See <a href="http://dev.chromium.org/developers/how-tos/get-the-code">Chromium document</a> for detailed instructions of getting the source code.</p><h2 id="generate-ninja-build-files-with-gn-for-chromium"><a name="generate-ninja-build-files-with-gn-for-chromium" href="#generate-ninja-build-files-with-gn-for-chromium"></a>Generate ninja build files with GN for Chromium</h2><pre class="bash hljs"><span class="hljs-built_in">cd</span> src
gn gen out/nw  (changing the <span class="hljs-string">'nw'</span> part of the path is not supported. You<span class="hljs-string">'d better not changing the '</span>out<span class="hljs-string">' part if you'</span>re new to this)
</pre><p>Use flags like our official build:</p><pre><code>is_debug=false
is_component_ffmpeg=true
target_cpu="x64"
</code></pre><p>We support component build: <code>is_component_build = true</code> for faster development cycle. It should be used when you are trying to build debug version.</p><p>See the upstream documentation for the mapping between GN and GYP flags: <a href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.html#Variable-mappings">https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Variable-mappings</a></p><h2 id="generate-ninja-build-files-with-gyp-for-node"><a name="generate-ninja-build-files-with-gyp-for-node" href="#generate-ninja-build-files-with-gyp-for-node"></a>Generate ninja build files with GYP for Node</h2><pre class="bash hljs"><span class="hljs-built_in">cd</span> src
GYP_CHROMIUM_NO_ACTION=<span class="hljs-number">0</span> ./build/gyp_chromium -I \
third_party/node-nw/common.gypi -D building_nw=<span class="hljs-number">1</span> \
-D clang=<span class="hljs-number">1</span> third_party/node-nw/node.gyp
</pre><p>or use the following if you’re doing a component build:</p><pre class="bash hljs">./build/gyp_chromium -D component=shared_library -I \
third_party/node-nw/common.gypi -D building_nw=<span class="hljs-number">1</span> \
-D clang=<span class="hljs-number">1</span> third_party/node-nw/node.gyp
</pre><p>To change the build configuration for Node, you need to setup the GYP_DEFINES environment variable:</p><h3 id="32-bit/64-bit-build"><a name="32-bit/64-bit-build" href="#32-bit/64-bit-build"></a>32-bit/64-bit Build</h3><ul>
<li>Windows<ul>
<li>32-bit: is the default build target</li><li>64-bit: <code>set GYP_DEFINES="target_arch=x64"</code> and rebuild in <code>out/Debug_x64</code> or <code>out/Release_x64</code> folder</li></ul>
</li><li>Linux<ul>
<li>32-bit: <strong>TODO: chroot</strong></li><li>64-bit: is the default build target</li></ul>
</li><li>Mac<ul>
<li>32-bit: <code>export GYP_DEFINES="host_arch=ia32 target_arch=ia32"</code> and rebuild in <code>out/Debug</code> or <code>out/Release</code> folder</li><li>64-bit: is the default build target</li></ul>
</li></ul><h2 id="build-nwjs"><a name="build-nwjs" href="#build-nwjs"></a>Build nwjs</h2><p>ninja build files are generated in <code>out/nw</code> folder after you run GN. Run following command in your terminal will generate the Debug build of standard NW.js binaries in <code>out/nw</code> folder:</p><pre class="bash hljs"><span class="hljs-built_in">cd</span> src
ninja -C out/nw nwjs
</pre><p>!!! tip “Build Time”<br>    Generally a full build takes hours of time depending on the performance of your machine. Recommended configuration is to build on a PC with multicore CPU (&gt;=8 cores), SSD and large memory (&gt;= 8G). And you can read <a href="#build-faster">Build Faster</a> section below for some tips to speed up the build.</p><p>To build 32-bit/64-bit binaries or non-standard build flavors, you need to edit out/nw/args.gn file And then re-run the commands above to generate binaries.</p><h2 id="build-node"><a name="build-node" href="#build-node"></a>Build Node</h2><pre class="bash hljs"><span class="hljs-built_in">cd</span> src
ninja -C out/Release node
</pre><p>After building Node, the final step is to copy the build Node library to the nwjs binary folder:</p><pre class="bash hljs"><span class="hljs-built_in">cd</span> src
ninja -C out/nw copy_node
</pre><h2 id="build-flavors"><a name="build-flavors" href="#build-flavors"></a>Build Flavors</h2><ul>
<li>Standard: ‘nwjs_sdk=false’</li><li>SDK: <code>enable_nacl=true</code></li></ul><p>See <a href="../For Users/Advanced/Build Flavors.html">Build Flavors</a> for the differences of all supported build flavors.</p><h2 id="enable-proprietary-codecs"><a name="enable-proprietary-codecs" href="#enable-proprietary-codecs"></a>Enable Proprietary Codecs</h2><p>Due to the license issue, the prebuilt binaries of NW.js doesn’t support proprietary codecs, like H.264. So you can’t play MP3/MP4 with <code>&lt;audio&gt;</code> and <code>&lt;video&gt;</code> tags with prebuilt NW.js. To enable those medias, you have to build NW.js from source code by following the document of <a href="Enable Proprietary Codecs.html">Enable Proprietary Codecs</a>.</p><h2 id="build-faster"><a name="build-faster" href="#build-faster"></a>Build Faster</h2><p>From Google’s website, there are a few tips to speed up your build. Open the links below to see the tips for your platform:</p><ul>
<li><a href="https://chromium.googlesource.com/chromium/src/+/master/docs/mac_build_instructions.md#Faster-builds">Mac Build Instructions: Faster builds</a></li><li><a href="https://chromium.googlesource.com/chromium/src/+/master/docs/linux_faster_builds.md">Tips for improving build speed on Linux</a></li></ul>


</body>
</html>
