<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>Screen.html</title>
  <meta name="generator" content="Haroopad 0.13.0" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="../asset/clearness-dark.css" rel="stylesheet">
</head>
<body class="markdown clearness-dark">
<p><strong>NOTE: some content in this wiki applies only to 0.12 and earlier versions. For official documentation on 0.13 and later, see <a href="http://docs.nwjs.io">http://docs.nwjs.io</a></strong></p><p><em>Screen API requires node-webkit &gt;= v0.10.2</em></p><p><code>Screen</code> is an instance of <a href="http://nodejs.org/api/events.html#events_class_events_eventemitter">EventEmitter</a> object, and you’re able to use <code>Screen.on(...)</code> to respond to native screen’s events.</p><p><code>Screen</code> is a singleton object, need to be initiated once by calling <code>gui.Screen.Init()</code></p><h2 id="reference"><a name="reference" href="#reference"></a>Reference</h2><h3 id="screen.init()"><a name="screen.init()" href="#screen.init()"></a>Screen.Init()</h3><p>Init the Screen singleton object, you only need to call this once</p><h3 id="screen.screens"><a name="screen.screens" href="#screen.screens"></a>Screen.screens</h3><p><strong>Get</strong> the array of screen (number of screen connected to the computer)</p><p>screen has following structure:</p><pre><code class="lang-javascript" data-origin="<pre><code class=&quot;lang-javascript&quot;>screen {
// unique id for a screen
  id: int,

// physical screen resolution, can be negative, not necessarily start from 0,depending on screen arrangement
  bounds: {
    x: int,
    y: int,
    width: int,
    height: int
  },

// useable area within the screen bound
  work_area: {
    x: int,
    y: int,
    width: int,
    height: int
  },

  scaleFactor: float,
  isBuiltIn: bool,
  rotation: int,
  touchSupport: int
}
</code></pre>">screen {
// unique id for a screen
  id: int,

// physical screen resolution, can be negative, not necessarily start from 0,depending on screen arrangement
  bounds: {
    x: int,
    y: int,
    width: int,
    height: int
  },

// useable area within the screen bound
  work_area: {
    x: int,
    y: int,
    width: int,
    height: int
  },

  scaleFactor: float,
  isBuiltIn: bool,
  rotation: int,
  touchSupport: int
}
</code></pre><h3 id="screen.choosedesktopmedia-(array-of-desktopcapturesourcetype-sources,-function-callback)"><a name="screen.choosedesktopmedia-(array-of-desktopcapturesourcetype-sources,-function-callback)" href="#screen.choosedesktopmedia-(array-of-desktopcapturesourcetype-sources,-function-callback)"></a>Screen.chooseDesktopMedia (array of DesktopCaptureSourceType sources, function callback)</h3><p><em>Screen.chooseDesktopMedia requires nwjs &gt;= v0.12.0</em><br><br>Screen sharing by selection; Currently only working in Windows and OSX and some linux distribution.<br><br><br>DesktopCaptureSourceType: <code>"window" or "screen"</code><br><br>The callback parameter should be a function that looks like this:<br><code>function(string streamId) {...};</code><br><br><code>returns false</code> if the function fails to execute or existing chooseDesktopMedia is still active<br><br><br><br>Example:  </p><pre><code class="lang-js" data-origin="<pre><code class=&quot;lang-js&quot;>var gui = require('nw.gui');
gui.Screen.Init(); // you only need to call this once
gui.Screen.chooseDesktopMedia([&quot;window&quot;,&quot;screen&quot;], 
  function(streamId) {
    var vid_constraint = {
      mandatory: {
        chromeMediaSource: 'desktop', 
        chromeMediaSourceId: streamId, 
        maxWidth: 1920, 
        maxHeight: 1080
      }, 
      optional: []
    };
    navigator.webkitGetUserMedia({audio: false, video: vid_constraint}, success_func, fallback_func);
  }
);
</code></pre>">var gui = require('nw.gui');
gui.Screen.Init(); // you only need to call this once
gui.Screen.chooseDesktopMedia(["window","screen"], 
  function(streamId) {
    var vid_constraint = {
      mandatory: {
        chromeMediaSource: 'desktop', 
        chromeMediaSourceId: streamId, 
        maxWidth: 1920, 
        maxHeight: 1080
      }, 
      optional: []
    };
    navigator.webkitGetUserMedia({audio: false, video: vid_constraint}, success_func, fallback_func);
  }
);
</code></pre><p>More info: <a href="https://github.com/nwjs/nw.js/issues/3077">https://github.com/nwjs/nw.js/issues/3077</a></p><h2 id="events"><a name="events" href="#events"></a>Events</h2><p>Following events can be listened by using <code>Screen.on()</code> function, for more information on how to receive events, you can visit <a href="http://nodejs.org/api/events.html#events_class_events_eventemitter">EventEmitter</a>.</p><h3 id="displayboundschanged"><a name="displayboundschanged" href="#displayboundschanged"></a>displayBoundsChanged</h3><p>emitted when the screen resolution, arrangement is changed, the callback is called with 1 argument `screen’</p><h3 id="displayadded"><a name="displayadded" href="#displayadded"></a>displayAdded</h3><p>emitted when a new screen added, the callback is called with 1 argument `screen’</p><h3 id="displayremoved"><a name="displayremoved" href="#displayremoved"></a>displayRemoved</h3><p>emitted when existing screen removed, the callback is called with 1 argument `screen’</p><h2 id="synopsis"><a name="synopsis" href="#synopsis"></a>Synopsis</h2><pre><code class="lang-javascript" data-origin="<pre><code class=&quot;lang-javascript&quot;>function ScreenToString(screen) {
  var string = &quot;&quot;;
  string += &quot;screen &quot; + screen.id + &quot; &quot;;
  var rect = screen.bounds;
  string += &quot;bound{&quot; + rect.x + &quot;, &quot; + rect.y + &quot;, &quot; + rect.width + &quot;, &quot; + rect.height + &quot;} &quot;;
  rect = screen.work_area;
  string += &quot;work_area{&quot; + rect.x + &quot;, &quot; + rect.y + &quot;, &quot; + rect.width + &quot;, &quot; + rect.height + &quot;} &quot;;
  string += &quot; scaleFactor: &quot; + screen.scaleFactor;
  string += &quot; isBuiltIn: &quot; + screen.isBuiltIn;
  string += &quot;&amp;lt;br&amp;gt;&quot;;
  return string;
}

//init must be called once during startup, before any function to gui.Screen can be called
gui.Screen.Init();
var string = &quot;&quot;;
var screens = gui.Screen.screens;
// store all the screen information into string
for (var i=0; i&amp;lt;screens.length; i++) {
  string += ScreenToString(screens[i]);
}

var screenCB = {
  onDisplayBoundsChanged: function(screen) {
    var out = &quot;OnDisplayBoundsChanged &quot; + ScreenToString(screen);
  },

  onDisplayAdded: function(screen) {
    var out = &quot;OnDisplayAdded &quot; + ScreenToString(screen);
  },

  onDisplayRemoved: function(screen) {
    var out = &quot;OnDisplayRemoved &quot; + ScreenToString(screen);
  }
};

// listen to screen events
gui.Screen.on('displayBoundsChanged', screenCB.onDisplayBoundsChanged);
gui.Screen.on('displayAdded', screenCB.onDisplayAdded);
gui.Screen.on('displayRemoved', screenCB.onDisplayRemoved);
</code></pre>">function ScreenToString(screen) {
  var string = "";
  string += "screen " + screen.id + " ";
  var rect = screen.bounds;
  string += "bound{" + rect.x + ", " + rect.y + ", " + rect.width + ", " + rect.height + "} ";
  rect = screen.work_area;
  string += "work_area{" + rect.x + ", " + rect.y + ", " + rect.width + ", " + rect.height + "} ";
  string += " scaleFactor: " + screen.scaleFactor;
  string += " isBuiltIn: " + screen.isBuiltIn;
  string += "&lt;br&gt;";
  return string;
}

//init must be called once during startup, before any function to gui.Screen can be called
gui.Screen.Init();
var string = "";
var screens = gui.Screen.screens;
// store all the screen information into string
for (var i=0; i&lt;screens.length; i++) {
  string += ScreenToString(screens[i]);
}

var screenCB = {
  onDisplayBoundsChanged: function(screen) {
    var out = "OnDisplayBoundsChanged " + ScreenToString(screen);
  },

  onDisplayAdded: function(screen) {
    var out = "OnDisplayAdded " + ScreenToString(screen);
  },

  onDisplayRemoved: function(screen) {
    var out = "OnDisplayRemoved " + ScreenToString(screen);
  }
};

// listen to screen events
gui.Screen.on('displayBoundsChanged', screenCB.onDisplayBoundsChanged);
gui.Screen.on('displayAdded', screenCB.onDisplayAdded);
gui.Screen.on('displayRemoved', screenCB.onDisplayRemoved);
</code></pre><h3 id="screen.desktopcapturemonitor"><a name="screen.desktopcapturemonitor" href="#screen.desktopcapturemonitor"></a>Screen.DesktopCaptureMonitor</h3><p><em>Screen.DesktopCaptureMonitor requires nwjs &gt;= v0.12.3</em><br></p><h4 id="screen.desktopcapturemonitor.start(should_include_screens,-should_include_windows)"><a name="screen.desktopcapturemonitor.start(should_include_screens,-should_include_windows)" href="#screen.desktopcapturemonitor.start(should_include_screens,-should_include_windows)"></a>Screen.DesktopCaptureMonitor.start(should_include_screens, should_include_windows)</h4><p>The DesktopCaptureMonitor will start monitoring the system and trigger the below events.  The screen may flicker if while DesktopCaptureMonitor is running.</p><h4 id="screen.desktopcapturemonitor.started"><a name="screen.desktopcapturemonitor.started" href="#screen.desktopcapturemonitor.started"></a>Screen.DesktopCaptureMonitor.started</h4><p>Boolean of whether the DesktopCaptureMonitor is started.</p><h4 id="screen.desktopcapturemonitor.stop()"><a name="screen.desktopcapturemonitor.stop()" href="#screen.desktopcapturemonitor.stop()"></a>Screen.DesktopCaptureMonitor.stop()</h4><p>The DesktopCaptureMonitor will stop monitoring the system.  The screen may flicker while DesktopCaptureMonitor is running.  The <code>id</code> provided can be passed into <code>chromeMediaSourceId</code> in <code>getUserMedia</code> constraints.  DesktopCaptureMonitor should be stopped after a stream is selected.</p><h4 id="events"><a name="events" href="#events"></a>Events</h4><p>Following events can be listened by using <code>Screen.DesktopCaptureMonitor.on()</code> function, for more information on how to receive events, you can visit <a href="http://nodejs.org/api/events.html#events_class_events_eventemitter">EventEmitter</a>.</p><h5 id="added-(id,-name,-order,-type,-primary)"><a name="added-(id,-name,-order,-type,-primary)" href="#added-(id,-name,-order,-type,-primary)"></a>added (id, name, order, type, primary)</h5><p>A new source was added.<br><br><code>id</code> is unique id that can be passed as chromeMediaSourceId<br><br><code>name</code> is the title of the window or screen<br><br><code>order</code> is the z-order of the windows, if screens are selected they will appear first<br><br><code>type</code> of the stream: “screen”, “window”, “other” or “unknown”<br><br><code>primary</code> on Windows OS only, this will be true if the source is the primary monitor<br></p><h5 id="removed-(id)"><a name="removed-(id)" href="#removed-(id)"></a>removed (id)</h5><p>A source was removed.<br><br><code>id</code> is the chromeMediaSourceId of the screen or monitor that is no longer capturable<br></p><h5 id="orderchanged-(id,-new_order,-old_order)"><a name="orderchanged-(id,-new_order,-old_order)" href="#orderchanged-(id,-new_order,-old_order)"></a>orderchanged (id, new_order, old_order)</h5><p>The Z-order of a source changed (this may change for windows as others are focused).<br><br><code>id</code> is the chromeMediaSourceId of the screen or window that has changed z-order<br><br><code>new_order</code> is the new z-order<br><br><code>old_order</code> is the old z-order<br></p><h5 id="namechanged-(id,-name)"><a name="namechanged-(id,-name)" href="#namechanged-(id,-name)"></a>namechanged (id, name)</h5><p>The name of the source has changed.  This can happen when a window changes title.<br><br><code>id</code> is the chromeMediaSourceId of the screen or window that has a name changed<br><br><code>name</code> is the new new name of the screen or window<br></p><h5 id="thumbnailchanged-(id,-thumbnail)"><a name="thumbnailchanged-(id,-thumbnail)" href="#thumbnailchanged-(id,-thumbnail)"></a>thumbnailchanged (id, thumbnail)</h5><p>The thumbnail of a source changed.<br><br><code>id</code> is the chromeMediaSourceId of the screen or window that has an updated thumbnail<br><br><code>thumbnail</code> is the base64 encoded png of the thumbnail<br></p><h4 id="sample"><a name="sample" href="#sample"></a>Sample</h4><pre><code class="lang-javascript" data-origin="<pre><code class=&quot;lang-javascript&quot;>gui.Screen.Init();
gui.Screen.DesktopCaptureMonitor.on(&quot;added&quot;, function (id, name, order, type) {
   //select first stream and shutdown
   var constraints = {
      audio: { //Note: Audio desktop capture only supported in Chromium in WindowsOS 
         mandatory: {
             chromeMediaSource: &quot;system&quot;,
             chromeMediaSourceId: id
          }
      },
      video: {
         mandatory: {
             chromeMediaSource: 'desktop',
             chromeMediaSourceId: id,
         }
      }
  };

  // TODO: call getUserMedia with contraints

  gui.Screen.DesktopCaptureMonitor.stop();
});

gui.Screen.DesktopCaptureMonitor.on(&quot;removed&quot;, function (id) { });
gui.Screen.DesktopCaptureMonitor.on(&quot;orderchanged&quot;, function (id, new_order, old_order) { });
gui.Screen.DesktopCaptureMonitor.on(&quot;namechanged&quot;, function (id, name) { });
gui.Screen.DesktopCaptureMonitor.on(&quot;thumbnailchanged&quot;, function (id, thumbnail) { });
gui.Screen.DesktopCaptureMonitor.start(true, true);
</code></pre>">gui.Screen.Init();
gui.Screen.DesktopCaptureMonitor.on("added", function (id, name, order, type) {
   //select first stream and shutdown
   var constraints = {
      audio: { //Note: Audio desktop capture only supported in Chromium in WindowsOS 
         mandatory: {
             chromeMediaSource: "system",
             chromeMediaSourceId: id
          }
      },
      video: {
         mandatory: {
             chromeMediaSource: 'desktop',
             chromeMediaSourceId: id,
         }
      }
  };

  // TODO: call getUserMedia with contraints

  gui.Screen.DesktopCaptureMonitor.stop();
});

gui.Screen.DesktopCaptureMonitor.on("removed", function (id) { });
gui.Screen.DesktopCaptureMonitor.on("orderchanged", function (id, new_order, old_order) { });
gui.Screen.DesktopCaptureMonitor.on("namechanged", function (id, name) { });
gui.Screen.DesktopCaptureMonitor.on("thumbnailchanged", function (id, thumbnail) { });
gui.Screen.DesktopCaptureMonitor.start(true, true);
</code></pre>


</body>
</html>
