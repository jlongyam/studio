<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>How-to-run-node-webkit's-test-cases.html</title>
  <meta name="generator" content="Haroopad 0.13.0" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="../asset/clearness-dark.css" rel="stylesheet">
</head>
<body class="markdown clearness-dark">
<p><strong>NOTE: some content in this wiki applies only to 0.12 and earlier versions. For official documentation on 0.13 and later, see <a href="http://docs.nwjs.io">http://docs.nwjs.io</a></strong></p><h2 id="prerequisite"><a name="prerequisite" href="#prerequisite"></a>Prerequisite</h2><ul>
<li>node-webkit didn’t ship third party node modules required for testing, you<br>need to install them.</li><li>We use <code>nw-gyp</code> to build native modules.</li><li>We have test cases that need a http server. And we have set up a simple nodejs server with port 8123 and 8124<br>opened. The http server document root is <code>tests/server</code>. You can add ports in <code>tests/server/server.js</code></li></ul><p>So please run this:</p><pre><code class="lang-bash" data-origin="<pre><code class=&quot;lang-bash&quot;>$ npm install -g nw-gyp
$ cd src/content/nw/tests
$ npm install -d
</code></pre>">$ npm install -g nw-gyp
$ cd src/content/nw/tests
$ npm install -d
</code></pre><h2 id="how-to-run-tests"><a name="how-to-run-tests" href="#how-to-run-tests"></a>How to run tests</h2><p>The test suits is indeed a node-webkit app, so use node-webkit to run it:</p><pre><code class="lang-bash" data-origin="<pre><code class=&quot;lang-bash&quot;>$ /path-to-node-webkit src/content/nw/tests
</code></pre>">$ /path-to-node-webkit src/content/nw/tests
</code></pre><h2 id="command-line-options"><a name="command-line-options" href="#command-line-options"></a>Command line options</h2><pre><code data-origin="<pre><code>$ /path-to-node-webkit src/content/nw/tests --help

  Usage: nw-test [options]

  Options:

    -h, --help             output usage information
    -V, --version          output the version number
    -S, --silent           hide the browser window and quit when done (run silently)
    -R, --reporter &amp;lt;name&amp;gt;  specify the reporter to use
    -g, --grep &amp;lt;pattern&amp;gt;   only run tests matching &amp;lt;pattern&amp;gt;
    -i, --invert           inverts --grep matches
    -t, --timeout &amp;lt;ms&amp;gt;     set test-case timeout in milliseconds [2000]
    -s, --slow &amp;lt;ms&amp;gt;        &quot;slow&quot; test threshold in milliseconds [75]
    -b, --bail             bail after first test failure
    -A, --async-only       force all tests to take a callback (async)
</code></pre>">$ /path-to-node-webkit src/content/nw/tests --help

  Usage: nw-test [options]

  Options:

    -h, --help             output usage information
    -V, --version          output the version number
    -S, --silent           hide the browser window and quit when done (run silently)
    -R, --reporter &lt;name&gt;  specify the reporter to use
    -g, --grep &lt;pattern&gt;   only run tests matching &lt;pattern&gt;
    -i, --invert           inverts --grep matches
    -t, --timeout &lt;ms&gt;     set test-case timeout in milliseconds [2000]
    -s, --slow &lt;ms&gt;        "slow" test threshold in milliseconds [75]
    -b, --bail             bail after first test failure
    -A, --async-only       force all tests to take a callback (async)
</code></pre><h3 id="-s,---silent"><a name="-s,---silent" href="#-s,---silent"></a>-S, —silent</h3><p>Hide the browser window (run silently), and quit the app when tests are done,<br>suitable for automatic tests system.</p><h3 id="-o,---output"><a name="-o,---output" href="#-o,---output"></a>-o, —output <name></name></h3><p>Output result to a file, this is usually used together with <code>json</code><br>reporter, so we can write the results of test to the file in the format of<br>JSON.</p><h3 id="-r,---reporter"><a name="-r,---reporter" href="#-r,---reporter"></a>-R, —reporter <name></name></h3><p>The <code>--reporter</code> option allows you to specify the reporter that will be used,<br>defaulting to <code>html</code>. This flag may also be used to utilize third-party<br>reporters. For example if you <code>npm install mocha-lcov-reporter</code> you may then<br>do <code>--reporter mocha-lcov-reporter</code>.</p><h3 id="-g,---grep"><a name="-g,---grep" href="#-g,---grep"></a>-g, —grep <pattern></pattern></h3><p>The <code>--grep</code> option when specified will trigger mocha to only run tests matching<br>the given pattern which is internally compiled to a RegExp.</p><p>Suppose for example you have <code>api</code> related tests, as well as <code>app</code> related<br>tests, as shown in the following snippet; One could use <code>--grep api</code> or<br><code>--grep app</code> to run one or the other. The same goes for any other part of a<br>suite or test-case title, <code>--grep users</code> would be valid as well, or even<br><code>--grep GET</code>.</p><pre><code class="lang-javascript" data-origin="<pre><code class=&quot;lang-javascript&quot;>describe('api', function(){
  describe('GET /api/users', function(){
    it('respond with an array of users')
  })
})

describe('app', function(){
  describe('GET /users', function(){
    it('respond with an array of users')
  })
})
</code></pre>">describe('api', function(){
  describe('GET /api/users', function(){
    it('respond with an array of users')
  })
})

describe('app', function(){
  describe('GET /users', function(){
    it('respond with an array of users')
  })
})
</code></pre><h3 id="-t,---timeout"><a name="-t,---timeout" href="#-t,---timeout"></a>-t, —timeout <ms></ms></h3><p>Specifies the test-case timeout, defaulting to 2 seconds. To override you<br>may pass the timeout in milliseconds, or a value with the s suffix, ex:<br><code>--timeout 2s</code> or <code>--timeout 2000</code> would be equivalent.</p><h3 id="-s,---slow"><a name="-s,---slow" href="#-s,---slow"></a>-s, —slow <ms></ms></h3><p>Specify the <code>slow</code> test threshold, defaulting to 75ms. Mocha uses this to<br>highlight test-cases that are taking too long.</p><h3 id="-b,---bail"><a name="-b,---bail" href="#-b,---bail"></a>-b, —bail</h3><p>Only interested in the first exception? use <code>--bail</code> !</p><h2 id="automatic-test"><a name="automatic-test" href="#automatic-test"></a>Automatic test</h2><p>To make the testing automatic, we need to:</p><ol>
<li>Write results to a file.</li><li>Print the results in a machine-readable format, like JSON.</li><li>Run tests silently and quit when done.</li></ol><p>In node-webkit’s test, we can do:</p><pre><code class="lang-bash" data-origin="<pre><code class=&quot;lang-bash&quot;>$ /path-to-node-webkit src/content/nw/tests --silent --output result.json --reporter json
</code></pre>">$ /path-to-node-webkit src/content/nw/tests --silent --output result.json --reporter json
</code></pre><h2 id="ignore-tests-that-take-too-long-to-run"><a name="ignore-tests-that-take-too-long-to-run" href="#ignore-tests-that-take-too-long-to-run"></a>Ignore tests that take too long to run</h2><p>Some tests like visiting html5test.com and getting its score would take too<br>long to run for normal tasks, these tests are usually marked as <code>long-to-run</code>,<br>so you can use following command to filter out them:</p><pre><code class="lang-bash" data-origin="<pre><code class=&quot;lang-bash&quot;>$ /path-to-node-webkit src/content/nw/tests --grep long-to-run -i
</code></pre>">$ /path-to-node-webkit src/content/nw/tests --grep long-to-run -i
</code></pre><h2 id="tips"><a name="tips" href="#tips"></a>Tips</h2><p>in test case like <code>node-remote</code>, we need to open a http server<br>to be the remote site. It is automatically opened when we run tests. We use port 8123, 8124 for test.<br>The http server document root is <code>tests/server</code>. We have put some resources there e.g. <code>node_remote_test.html</code>.</p><h2 id="native-modules"><a name="native-modules" href="#native-modules"></a>Native Modules</h2><p>When there is a new nw release, We hope you to rebuild native modules.</p><p>We use <code>tools/build_native_modules.py</code> to build our native modules:</p><pre><code class="lang-bash" data-origin="<pre><code class=&quot;lang-bash&quot;>$ cd src/content/nw
$ python tools/build_native_modules.py`
</code></pre>">$ cd src/content/nw
$ python tools/build_native_modules.py`
</code></pre><p>Also, please update <code>node_modules</code> using <code>npm install -d</code>.</p>


</body>
</html>
